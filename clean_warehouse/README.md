# Warehouse Order Management (Clean Architecture)

## Описание

Проект представляет собой упрощённое backend-приложение для управления заказами и товарами на складе.  
Реализация выполнена с соблюдением принципов **Clean Architecture** и разделением ответственности между слоями.

Система позволяет:
- оформлять заказ для покупателя;
- проверять наличие товаров на складе;
- атомарно списывать остатки;
- сохранять заказ и его позиции;
- корректно обрабатывать ошибки (нет товара, не найден покупатель и т.д.).

---

## Архитектура

Проект разделён на логические слои:

app/
├── domain/ # Доменная модель и бизнес-правила
├── application/ # Use cases, DTO, Unit of Work (абстракции)
├── infrastructure/ # Реализации репозиториев и UoW (SQL)
├── presentation/ # Веб-слой (Flask)
tests/ # Unit и интеграционные тесты


### Domain

Содержит доменные сущности и бизнес-логику:
- `Product` — товар со складским остатком
- `Order`, `OrderItem` — заказ и его позиции
- `Customer` — покупатель
- доменные ошибки (`OutOfStockError`, `NotFoundError`)

Доменный слой **не зависит** от Flask, SQL или других инфраструктурных деталей.

---

### Application

Слой сценариев использования (use cases):

- `PlaceOrderUseCase` — сценарий оформления заказа
- DTO (`PlaceOrderCommand`, `OrderLineDTO`) — передача входных данных
- `UnitOfWork` и интерфейсы репозиториев (через `Protocol`)

Use case:
- не знает о БД и HTTP;
- работает только с абстракциями;
- управляет бизнес-операцией целиком.

---

### Infrastructure

Содержит конкретные реализации:
- SQL-репозитории (`ProductRepositorySQL`, `OrderRepositorySQL` и др.)
- `SqlUnitOfWork` — управление транзакцией (`commit` / `rollback`)
- схема базы данных (SQLite)

Infrastructure зависит от application и domain, но не наоборот.

---

### Presentation

HTTP-адаптер на Flask:
- принимает HTTP-запросы;
- преобразует данные в DTO;
- вызывает use case;
- формирует HTTP-ответы.

Flask-слой не содержит бизнес-логики.

---

## Unit of Work

`UnitOfWork` используется для управления транзакцией одной бизнес-операции.

Принцип работы:
- все изменения выполняются внутри блока `with uow:`;
- при возникновении исключения вызывается `rollback`;
- при успешном завершении операции выполняется явный `commit`.

Это гарантирует атомарность оформления заказа.

---

## Тестирование

Реализованы два типа тестов.

### Unit-тесты
- используют **in-memory Unit of Work**;
- не зависят от базы данных;
- проверяют бизнес-логику use case.

### Интеграционные тесты
- используют SQLite (`:memory:`);
- проверяют работу SQL-репозиториев и транзакций.

Запуск тестов:
```bash
pytest
